<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="seantis.dir.events">
<body>

<metal:block fill-slot="head_slot">
  <metal:use use-macro="context/@@seantis-dir-macros/macros/openlayers"></metal:use>
</metal:block>

<metal:main fill-slot="main">
    <tal:main-macro metal:define-macro="main">

    <div tal:replace="structure provider:plone.abovecontenttitle" />

    <a tal:attributes="href python: context.absolute_url() + '?reset=true'"><h1 class="documentFirstHeading" tal:content="context/title" /></a>

    <div tal:replace="structure provider:plone.belowcontenttitle" />
    <div tal:replace="structure provider:plone.abovecontentbody" />

        <tal:block condition="python: not view.filtered">
            <div tal:replace="structure provider:seantis.dir.base.directory.viewletmanager"/>
        </tal:block>

        <div id="directoryInfo" tal:define="groups python: view.groups(view.batch);">
          
            <div class="directoryDates">
                <h3 i18n:translate="">Date</h3>
                <ul>
                    <li tal:repeat="method view/dateranges"><a tal:content="python: method[1]" tal:attributes="href python: view.daterange_url(method[0]); class python: method[0] == view.selected_daterange and 'selected' or ''; title python: method[2]"></a></li>
                </ul>

                <div class="ical-links">
                  <h3 i18n:translate="">Calendars (iCal)</h3>
                  <ul>
                    <li>
                      <a tal:attributes="href python: view.ical_url(for_all=True)" i18n:translate="">Calendar for all events</a>
                    </li>
                    <li tal:condition="python: view.ical_url(for_all=False)">
                      <a tal:attributes="href python: view.ical_url(for_all=False)" i18n:translate="">Calendar for events matching the current filter</a>
                    </li>
                  </ul>
                </div>
            </div>


            <div id="directoryResultList" class="no-results" i18n:translate="" tal:condition="python: not view.has_results">
              No Events
            </div>
          
            <div id="directoryResultList" tal:condition="python: view.has_results">

              <tal:block repeat="group python: groups.items()">
                <div class="eventgroup-title" tal:content="python: group[0]"></div>
                <div class="eventgroup">
                  <div class="directoryResult event" tal:repeat="item python: group[1]" tal:attributes="id item/id; class python: 'event-state-%s' % item.state">
                    <metal:use use-macro="context/@@seantis-dir-macros/macros/map-marker"></metal:use>

                    <div class="directoryInfoText">
                      
                      <div class="event-image" tal:condition="item/image">
                        <a tal:attributes="href string:${item/absolute_url}/@@images/image">
                          <img tal:replace="structure item/@@images/image/tile" />
                        </a>
                      </div>

                      <h3><a
                        tal:attributes="href python: item.url()" 
                        tal:content="item/title">
                      </a></h3>

                      <div class="short" tal:content="item/short_description"></div>
                        
                      <div class="eventtags-list">
                        <tal:block repeat="category python: item.categories()[:2]">
                            <div class="eventtags" tal:condition="python: category[2]" tal:content="python: ', '.join(category[2])"></div>
                        </tal:block>
                      </div>

                      <div class="timerange" tal:content="python: item.human_daterange(view.request)"></div>

                      <div class="visualClear"></div>
                    </div>
                  </div>
                </div>
                
              </tal:block>
            </div>

            <div class="event-sidebar">
              <metal:use use-macro="context/@@seantis-dir-macros/macros/map">
              </metal:use>
              <div class="your-event">
                <p i18n:translate="">Dou you have an event to share?</p>
                <a i18n:translate="" tal:attributes="href python: context.absolute_url() + '/submit-event'">Submit Your Event</a>
              </div>
            </div>

            <div class="visualClear"></div>
        </div>

    <div tal:replace="structure provider:plone.belowcontentbody" />
        <tal:block define="batch view/batch">
            <div metal:use-macro="here/batch_macros/macros/navigation" />
        </tal:block>

    </tal:main-macro>
</metal:main>

</body>
</html>